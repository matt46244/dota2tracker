require 'spec_helper'
require 'last_match_helper'
require 'steam_helper'

describe LastMatchHelper do
  let( :api_key )     { :api_key }
  let( :account_id )  { 7384958 }
  let( :parsed_heroes ) {
  {"result"=>{"heroes"=>[{"name"=>"npc_dota_hero_antimage", "id"=>1}, {"name"=>"npc_dota_hero_axe", "id"=>2}, {"name"=>"npc_dota_hero_bane", "id"=>3}, {"name"=>"npc_dota_hero_bloodseeker", "id"=>4}, {"name"=>"npc_dota_hero_crystal_maiden", "id"=>5}, {"name"=>"npc_dota_hero_drow_ranger", "id"=>6}, {"name"=>"npc_dota_hero_earthshaker", "id"=>7}, {"name"=>"npc_dota_hero_juggernaut", "id"=>8}, {"name"=>"npc_dota_hero_mirana", "id"=>9}, {"name"=>"npc_dota_hero_nevermore", "id"=>11}, {"name"=>"npc_dota_hero_morphling", "id"=>10}, {"name"=>"npc_dota_hero_phantom_lancer", "id"=>12}, {"name"=>"npc_dota_hero_puck", "id"=>13}, {"name"=>"npc_dota_hero_pudge", "id"=>14}, {"name"=>"npc_dota_hero_razor", "id"=>15}, {"name"=>"npc_dota_hero_sand_king", "id"=>16}, {"name"=>"npc_dota_hero_storm_spirit", "id"=>17}, {"name"=>"npc_dota_hero_sven", "id"=>18}, {"name"=>"npc_dota_hero_tiny", "id"=>19}, {"name"=>"npc_dota_hero_vengefulspirit", "id"=>20}, {"name"=>"npc_dota_hero_windrunner", "id"=>21}, {"name"=>"npc_dota_hero_zuus", "id"=>22}, {"name"=>"npc_dota_hero_kunkka", "id"=>23}, {"name"=>"npc_dota_hero_lina", "id"=>25}, {"name"=>"npc_dota_hero_lich", "id"=>31}, {"name"=>"npc_dota_hero_lion", "id"=>26}, {"name"=>"npc_dota_hero_shadow_shaman", "id"=>27}, {"name"=>"npc_dota_hero_slardar", "id"=>28}, {"name"=>"npc_dota_hero_tidehunter", "id"=>29}, {"name"=>"npc_dota_hero_witch_doctor", "id"=>30}, {"name"=>"npc_dota_hero_riki", "id"=>32}, {"name"=>"npc_dota_hero_enigma", "id"=>33}, {"name"=>"npc_dota_hero_tinker", "id"=>34}, {"name"=>"npc_dota_hero_sniper", "id"=>35}, {"name"=>"npc_dota_hero_necrolyte", "id"=>36}, {"name"=>"npc_dota_hero_warlock", "id"=>37}, {"name"=>"npc_dota_hero_beastmaster", "id"=>38}, {"name"=>"npc_dota_hero_queenofpain", "id"=>39}, {"name"=>"npc_dota_hero_venomancer", "id"=>40}, {"name"=>"npc_dota_hero_faceless_void", "id"=>41}, {"name"=>"npc_dota_hero_skeleton_king", "id"=>42}, {"name"=>"npc_dota_hero_death_prophet", "id"=>43}, {"name"=>"npc_dota_hero_phantom_assassin", "id"=>44}, {"name"=>"npc_dota_hero_pugna", "id"=>45}, {"name"=>"npc_dota_hero_templar_assassin", "id"=>46}, {"name"=>"npc_dota_hero_viper", "id"=>47}, {"name"=>"npc_dota_hero_luna", "id"=>48}, {"name"=>"npc_dota_hero_dragon_knight", "id"=>49}, {"name"=>"npc_dota_hero_dazzle", "id"=>50}, {"name"=>"npc_dota_hero_rattletrap", "id"=>51}, {"name"=>"npc_dota_hero_leshrac", "id"=>52}, {"name"=>"npc_dota_hero_furion", "id"=>53}, {"name"=>"npc_dota_hero_life_stealer", "id"=>54}, {"name"=>"npc_dota_hero_dark_seer", "id"=>55}, {"name"=>"npc_dota_hero_clinkz", "id"=>56}, {"name"=>"npc_dota_hero_omniknight", "id"=>57}, {"name"=>"npc_dota_hero_enchantress", "id"=>58}, {"name"=>"npc_dota_hero_huskar", "id"=>59}, {"name"=>"npc_dota_hero_night_stalker", "id"=>60}, {"name"=>"npc_dota_hero_broodmother", "id"=>61}, {"name"=>"npc_dota_hero_bounty_hunter", "id"=>62}, {"name"=>"npc_dota_hero_weaver", "id"=>63}, {"name"=>"npc_dota_hero_jakiro", "id"=>64}, {"name"=>"npc_dota_hero_batrider", "id"=>65}, {"name"=>"npc_dota_hero_chen", "id"=>66}, {"name"=>"npc_dota_hero_spectre", "id"=>67}, {"name"=>"npc_dota_hero_doom_bringer", "id"=>69}, {"name"=>"npc_dota_hero_ancient_apparition", "id"=>68}, {"name"=>"npc_dota_hero_ursa", "id"=>70}, {"name"=>"npc_dota_hero_spirit_breaker", "id"=>71}, {"name"=>"npc_dota_hero_gyrocopter", "id"=>72}, {"name"=>"npc_dota_hero_alchemist", "id"=>73}, {"name"=>"npc_dota_hero_invoker", "id"=>74}, {"name"=>"npc_dota_hero_silencer", "id"=>75}, {"name"=>"npc_dota_hero_obsidian_destroyer", "id"=>76}, {"name"=>"npc_dota_hero_lycan", "id"=>77}, {"name"=>"npc_dota_hero_brewmaster", "id"=>78}, {"name"=>"npc_dota_hero_shadow_demon", "id"=>79}, {"name"=>"npc_dota_hero_lone_druid", "id"=>80}, {"name"=>"npc_dota_hero_chaos_knight", "id"=>81}, {"name"=>"npc_dota_hero_meepo", "id"=>82}, {"name"=>"npc_dota_hero_treant", "id"=>83}, {"name"=>"npc_dota_hero_ogre_magi", "id"=>84}, {"name"=>"npc_dota_hero_undying", "id"=>85}, {"name"=>"npc_dota_hero_rubick", "id"=>86}, {"name"=>"npc_dota_hero_disruptor", "id"=>87}, {"name"=>"npc_dota_hero_nyx_assassin", "id"=>88}, {"name"=>"npc_dota_hero_naga_siren", "id"=>89}, {"name"=>"npc_dota_hero_keeper_of_the_light", "id"=>90}, {"name"=>"npc_dota_hero_wisp", "id"=>91}, {"name"=>"npc_dota_hero_visage", "id"=>92}, {"name"=>"npc_dota_hero_slark", "id"=>93}, {"name"=>"npc_dota_hero_medusa", "id"=>94}, {"name"=>"npc_dota_hero_troll_warlord", "id"=>95}, {"name"=>"npc_dota_hero_centaur", "id"=>96}, {"name"=>"npc_dota_hero_magnataur", "id"=>97}, {"name"=>"npc_dota_hero_shredder", "id"=>98}, {"name"=>"npc_dota_hero_bristleback", "id"=>99}, {"name"=>"npc_dota_hero_tusk", "id"=>100}, {"name"=>"npc_dota_hero_skywrath_mage", "id"=>101}, {"name"=>"npc_dota_hero_abaddon", "id"=>102}, {"name"=>"npc_dota_hero_elder_titan", "id"=>103}, {"name"=>"npc_dota_hero_legion_commander", "id"=>104}], "count"=>103}}
  }

  let( :heroes ) {
    "{\n\t\"result\": {\n\t\t\"heroes\": [\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_antimage\",\n\t\t\t\t\"id\": 1\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_axe\",\n\t\t\t\t\"id\": 2\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_bane\",\n\t\t\t\t\"id\": 3\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_bloodseeker\",\n\t\t\t\t\"id\": 4\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_crystal_maiden\",\n\t\t\t\t\"id\": 5\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_drow_ranger\",\n\t\t\t\t\"id\": 6\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_earthshaker\",\n\t\t\t\t\"id\": 7\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_juggernaut\",\n\t\t\t\t\"id\": 8\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_mirana\",\n\t\t\t\t\"id\": 9\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_nevermore\",\n\t\t\t\t\"id\": 11\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_morphling\",\n\t\t\t\t\"id\": 10\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_phantom_lancer\",\n\t\t\t\t\"id\": 12\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_puck\",\n\t\t\t\t\"id\": 13\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_pudge\",\n\t\t\t\t\"id\": 14\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_razor\",\n\t\t\t\t\"id\": 15\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_sand_king\",\n\t\t\t\t\"id\": 16\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_storm_spirit\",\n\t\t\t\t\"id\": 17\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_sven\",\n\t\t\t\t\"id\": 18\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_tiny\",\n\t\t\t\t\"id\": 19\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_vengefulspirit\",\n\t\t\t\t\"id\": 20\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_windrunner\",\n\t\t\t\t\"id\": 21\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_zuus\",\n\t\t\t\t\"id\": 22\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_kunkka\",\n\t\t\t\t\"id\": 23\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_lina\",\n\t\t\t\t\"id\": 25\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_lich\",\n\t\t\t\t\"id\": 31\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_lion\",\n\t\t\t\t\"id\": 26\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_shadow_shaman\",\n\t\t\t\t\"id\": 27\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_slardar\",\n\t\t\t\t\"id\": 28\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_tidehunter\",\n\t\t\t\t\"id\": 29\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_witch_doctor\",\n\t\t\t\t\"id\": 30\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_riki\",\n\t\t\t\t\"id\": 32\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_enigma\",\n\t\t\t\t\"id\": 33\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_tinker\",\n\t\t\t\t\"id\": 34\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_sniper\",\n\t\t\t\t\"id\": 35\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_necrolyte\",\n\t\t\t\t\"id\": 36\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_warlock\",\n\t\t\t\t\"id\": 37\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_beastmaster\",\n\t\t\t\t\"id\": 38\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_queenofpain\",\n\t\t\t\t\"id\": 39\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_venomancer\",\n\t\t\t\t\"id\": 40\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_faceless_void\",\n\t\t\t\t\"id\": 41\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_skeleton_king\",\n\t\t\t\t\"id\": 42\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_death_prophet\",\n\t\t\t\t\"id\": 43\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_phantom_assassin\",\n\t\t\t\t\"id\": 44\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_pugna\",\n\t\t\t\t\"id\": 45\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_templar_assassin\",\n\t\t\t\t\"id\": 46\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_viper\",\n\t\t\t\t\"id\": 47\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_luna\",\n\t\t\t\t\"id\": 48\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_dragon_knight\",\n\t\t\t\t\"id\": 49\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_dazzle\",\n\t\t\t\t\"id\": 50\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_rattletrap\",\n\t\t\t\t\"id\": 51\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_leshrac\",\n\t\t\t\t\"id\": 52\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_furion\",\n\t\t\t\t\"id\": 53\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_life_stealer\",\n\t\t\t\t\"id\": 54\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_dark_seer\",\n\t\t\t\t\"id\": 55\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_clinkz\",\n\t\t\t\t\"id\": 56\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_omniknight\",\n\t\t\t\t\"id\": 57\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_enchantress\",\n\t\t\t\t\"id\": 58\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_huskar\",\n\t\t\t\t\"id\": 59\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_night_stalker\",\n\t\t\t\t\"id\": 60\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_broodmother\",\n\t\t\t\t\"id\": 61\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_bounty_hunter\",\n\t\t\t\t\"id\": 62\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_weaver\",\n\t\t\t\t\"id\": 63\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_jakiro\",\n\t\t\t\t\"id\": 64\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_batrider\",\n\t\t\t\t\"id\": 65\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_chen\",\n\t\t\t\t\"id\": 66\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_spectre\",\n\t\t\t\t\"id\": 67\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_doom_bringer\",\n\t\t\t\t\"id\": 69\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_ancient_apparition\",\n\t\t\t\t\"id\": 68\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_ursa\",\n\t\t\t\t\"id\": 70\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_spirit_breaker\",\n\t\t\t\t\"id\": 71\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_gyrocopter\",\n\t\t\t\t\"id\": 72\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_alchemist\",\n\t\t\t\t\"id\": 73\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_invoker\",\n\t\t\t\t\"id\": 74\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_silencer\",\n\t\t\t\t\"id\": 75\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_obsidian_destroyer\",\n\t\t\t\t\"id\": 76\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_lycan\",\n\t\t\t\t\"id\": 77\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_brewmaster\",\n\t\t\t\t\"id\": 78\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_shadow_demon\",\n\t\t\t\t\"id\": 79\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_lone_druid\",\n\t\t\t\t\"id\": 80\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_chaos_knight\",\n\t\t\t\t\"id\": 81\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_meepo\",\n\t\t\t\t\"id\": 82\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_treant\",\n\t\t\t\t\"id\": 83\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_ogre_magi\",\n\t\t\t\t\"id\": 84\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_undying\",\n\t\t\t\t\"id\": 85\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_rubick\",\n\t\t\t\t\"id\": 86\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_disruptor\",\n\t\t\t\t\"id\": 87\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_nyx_assassin\",\n\t\t\t\t\"id\": 88\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_naga_siren\",\n\t\t\t\t\"id\": 89\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_keeper_of_the_light\",\n\t\t\t\t\"id\": 90\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_wisp\",\n\t\t\t\t\"id\": 91\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_visage\",\n\t\t\t\t\"id\": 92\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_slark\",\n\t\t\t\t\"id\": 93\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_medusa\",\n\t\t\t\t\"id\": 94\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_troll_warlord\",\n\t\t\t\t\"id\": 95\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_centaur\",\n\t\t\t\t\"id\": 96\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_magnataur\",\n\t\t\t\t\"id\": 97\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_shredder\",\n\t\t\t\t\"id\": 98\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_bristleback\",\n\t\t\t\t\"id\": 99\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_tusk\",\n\t\t\t\t\"id\": 100\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_skywrath_mage\",\n\t\t\t\t\"id\": 101\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_abaddon\",\n\t\t\t\t\"id\": 102\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_elder_titan\",\n\t\t\t\t\"id\": 103\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"npc_dota_hero_legion_commander\",\n\t\t\t\t\"id\": 104\n\t\t\t}\n\t\t]\n\t\t,\n\t\t\"count\": 103\n\t}\n}"
  }

  let( :recent_match ) {
    "{ \"result\": {\"matches\": {\"match_id\":346700273,\"match_seq_num\":315943455,\"start_time\":1381894089,\"lobby_type\":0,\"players\":[{\"account_id\":33977142,\"player_slot\":0,\"hero_id\":86},{\"account_id\":34575066,\"player_slot\":1,\"hero_id\":19},{\"account_id\":4294967295,\"player_slot\":2,\"hero_id\":82},{\"account_id\":7384958,\"player_slot\":3,\"hero_id\":5},{\"account_id\":52816,\"player_slot\":4,\"hero_id\":3},{\"account_id\":4294967295,\"player_slot\":128,\"hero_id\":13},{\"account_id\":93115498,\"player_slot\":129,\"hero_id\":1},{\"account_id\":5789937,\"player_slot\":130,\"hero_id\":16},{\"account_id\":4294967295,\"player_slot\":131,\"hero_id\":40},{\"account_id\":88491477,\"player_slot\":132,\"hero_id\":100}]}}}"
  }

  let( :parsed_match ) {
    {"match_id"=>346700273, "match_seq_num"=>315943455, "start_time"=>1381894089, "lobby_type"=>0, "players"=>[{"account_id"=>33977142, "player_slot"=>0, "hero_id"=>86}, {"account_id"=>34575066, "player_slot"=>1, "hero_id"=>19}, {"account_id"=>4294967295, "player_slot"=>2, "hero_id"=>82}, {"account_id"=>7384958, "player_slot"=>3, "hero_id"=>5}, {"account_id"=>52816, "player_slot"=>4, "hero_id"=>3}, {"account_id"=>4294967295, "player_slot"=>128, "hero_id"=>13}, {"account_id"=>93115498, "player_slot"=>129, "hero_id"=>1}, {"account_id"=>5789937, "player_slot"=>130, "hero_id"=>16}, {"account_id"=>4294967295, "player_slot"=>131, "hero_id"=>40}, {"account_id"=>88491477, "player_slot"=>132, "hero_id"=>100}]}
  }

  let( :recent_match_details ) {
  "{\"result\":{\"players\":[{\"account_id\":33977142,\"player_slot\":0,\"hero_id\":86,\"item_0\":100,\"item_1\":37,\"item_2\":50,\"item_3\":1,\"item_4\":41,\"item_5\":0,\"kills\":5,\"deaths\":8,\"assists\":8,\"leaver_status\":0,\"gold\":853,\"last_hits\":78,\"denies\":4,\"gold_per_min\":283,\"xp_per_min\":299,\"gold_spent\":10937,\"hero_damage\":10004,\"tower_damage\":464,\"hero_healing\":0,\"level\":15,\"ability_upgrades\":[{\"ability\":5448,\"time\":371,\"level\":1},{\"ability\":5450,\"time\":534,\"level\":2},{\"ability\":5450,\"time\":721,\"level\":3},{\"ability\":5451,\"time\":840,\"level\":4},{\"ability\":5450,\"time\":904,\"level\":5},{\"ability\":5452,\"time\":1160,\"level\":6},{\"ability\":5450,\"time\":1197,\"level\":7},{\"ability\":5451,\"time\":1251,\"level\":8},{\"ability\":5451,\"time\":1417,\"level\":9},{\"ability\":5452,\"time\":1749,\"level\":10},{\"ability\":5451,\"time\":1749,\"level\":11},{\"ability\":5448,\"time\":2092,\"level\":12},{\"ability\":5448,\"time\":2276,\"level\":13},{\"ability\":5448,\"time\":2551,\"level\":14},{\"ability\":5002,\"time\":2947,\"level\":15}]},{\"account_id\":34575066,\"player_slot\":1,\"hero_id\":19,\"item_0\":1,\"item_1\":147,\"item_2\":41,\"item_3\":63,\"item_4\":108,\"item_5\":0,\"kills\":9,\"deaths\":9,\"assists\":13,\"leaver_status\":0,\"gold\":385,\"last_hits\":190,\"denies\":13,\"gold_per_min\":400,\"xp_per_min\":428,\"gold_spent\":15134,\"hero_damage\":20473,\"tower_damage\":1684,\"hero_healing\":0,\"level\":19,\"ability_upgrades\":[{\"ability\":5106,\"time\":387,\"level\":1},{\"ability\":5107,\"time\":543,\"level\":2},{\"ability\":5106,\"time\":543,\"level\":3},{\"ability\":5107,\"time\":603,\"level\":4},{\"ability\":5106,\"time\":691,\"level\":5},{\"ability\":5109,\"time\":742,\"level\":6},{\"ability\":5107,\"time\":802,\"level\":7},{\"ability\":5107,\"time\":835,\"level\":8},{\"ability\":5106,\"time\":1040,\"level\":9},{\"ability\":5108,\"time\":1182,\"level\":10},{\"ability\":5109,\"time\":1206,\"level\":11},{\"ability\":5108,\"time\":1450,\"level\":12},{\"ability\":5108,\"time\":1551,\"level\":13},{\"ability\":5108,\"time\":1750,\"level\":14},{\"ability\":5002,\"time\":2060,\"level\":15},{\"ability\":5109,\"time\":2440,\"level\":16},{\"ability\":5002,\"time\":2558,\"level\":17},{\"ability\":5002,\"time\":2798,\"level\":18},{\"ability\":5002,\"time\":3028,\"level\":19}]},{\"account_id\":4294967295,\"player_slot\":2,\"hero_id\":82,\"item_0\":63,\"item_1\":53,\"item_2\":108,\"item_3\":81,\"item_4\":1,\"item_5\":61,\"kills\":6,\"deaths\":12,\"assists\":8,\"leaver_status\":0,\"gold\":744,\"last_hits\":260,\"denies\":10,\"gold_per_min\":460,\"xp_per_min\":730,\"gold_spent\":15270,\"hero_damage\":12810,\"tower_damage\":2113,\"hero_healing\":105,\"level\":25,\"ability_upgrades\":[{\"ability\":5430,\"time\":505,\"level\":1},{\"ability\":5431,\"time\":512,\"level\":2},{\"ability\":5431,\"time\":560,\"level\":3},{\"ability\":5432,\"time\":649,\"level\":4},{\"ability\":5431,\"time\":734,\"level\":5},{\"ability\":5433,\"time\":855,\"level\":6},{\"ability\":5431,\"time\":907,\"level\":7},{\"ability\":5430,\"time\":965,\"level\":8},{\"ability\":5430,\"time\":1055,\"level\":9},{\"ability\":5430,\"time\":1132,\"level\":10},{\"ability\":5433,\"time\":1181,\"level\":11},{\"ability\":5432,\"time\":1358,\"level\":12},{\"ability\":5432,\"time\":1478,\"level\":13},{\"ability\":5432,\"time\":1567,\"level\":14},{\"ability\":5002,\"time\":1628,\"level\":15},{\"ability\":5433,\"time\":1780,\"level\":16},{\"ability\":5002,\"time\":1857,\"level\":17},{\"ability\":5002,\"time\":2027,\"level\":18},{\"ability\":5002,\"time\":2220,\"level\":19},{\"ability\":5002,\"time\":2357,\"level\":20},{\"ability\":5002,\"time\":2467,\"level\":21},{\"ability\":5002,\"time\":2551,\"level\":22},{\"ability\":5002,\"time\":2551,\"level\":23},{\"ability\":5002,\"time\":2593,\"level\":24},{\"ability\":5002,\"time\":2788,\"level\":25}]},{\"account_id\":7384958,\"player_slot\":3,\"hero_id\":5,\"item_0\":79,\"item_1\":180,\"item_2\":36,\"item_3\":46,\"item_4\":23,\"item_5\":27,\"kills\":5,\"deaths\":9,\"assists\":10,\"leaver_status\":0,\"gold\":38,\"last_hits\":36,\"denies\":3,\"gold_per_min\":209,\"xp_per_min\":244,\"gold_spent\":8786,\"hero_damage\":7682,\"tower_damage\":193,\"hero_healing\":423,\"level\":14,\"ability_upgrades\":[{\"ability\":5127,\"time\":467,\"level\":1},{\"ability\":5126,\"time\":793,\"level\":2},{\"ability\":5126,\"time\":882,\"level\":3},{\"ability\":5128,\"time\":981,\"level\":4},{\"ability\":5126,\"time\":1105,\"level\":5},{\"ability\":5127,\"time\":1259,\"level\":6},{\"ability\":5126,\"time\":1323,\"level\":7},{\"ability\":5127,\"time\":1460,\"level\":8},{\"ability\":5128,\"time\":1558,\"level\":9},{\"ability\":5128,\"time\":1585,\"level\":10},{\"ability\":5128,\"time\":1753,\"level\":11},{\"ability\":5129,\"time\":2411,\"level\":12},{\"ability\":5129,\"time\":2496,\"level\":13},{\"ability\":5127,\"time\":3067,\"level\":14}]},{\"account_id\":52816,\"player_slot\":4,\"hero_id\":3,\"item_0\":90,\"item_1\":180,\"item_2\":42,\"item_3\":36,\"item_4\":46,\"item_5\":21,\"kills\":8,\"deaths\":9,\"assists\":7,\"leaver_status\":0,\"gold\":949,\"last_hits\":34,\"denies\":16,\"gold_per_min\":237,\"xp_per_min\":334,\"gold_spent\":9130,\"hero_damage\":7016,\"tower_damage\":423,\"hero_healing\":0,\"level\":16,\"ability_upgrades\":[{\"ability\":5011,\"time\":491,\"level\":1},{\"ability\":5014,\"time\":631,\"level\":2},{\"ability\":5011,\"time\":784,\"level\":3},{\"ability\":5012,\"time\":976,\"level\":4},{\"ability\":5011,\"time\":1101,\"level\":5},{\"ability\":5013,\"time\":1181,\"level\":6},{\"ability\":5011,\"time\":1319,\"level\":7},{\"ability\":5012,\"time\":1435,\"level\":8},{\"ability\":5012,\"time\":1581,\"level\":9},{\"ability\":5012,\"time\":1668,\"level\":10},{\"ability\":5013,\"time\":1709,\"level\":11},{\"ability\":5014,\"time\":1747,\"level\":12},{\"ability\":5014,\"time\":1909,\"level\":13},{\"ability\":5014,\"time\":2128,\"level\":14},{\"ability\":5002,\"time\":2499,\"level\":15},{\"ability\":5013,\"time\":2885,\"level\":16}]},{\"account_id\":4294967295,\"player_slot\":128,\"hero_id\":13,\"item_0\":1,\"item_1\":100,\"item_2\":96,\"item_3\":36,\"item_4\":63,\"item_5\":46,\"kills\":9,\"deaths\":7,\"assists\":29,\"leaver_status\":0,\"gold\":3379,\"last_hits\":155,\"denies\":7,\"gold_per_min\":452,\"xp_per_min\":706,\"gold_spent\":15259,\"hero_damage\":24236,\"tower_damage\":2159,\"hero_healing\":0,\"level\":24,\"ability_upgrades\":[{\"ability\":5069,\"time\":410,\"level\":1},{\"ability\":5072,\"time\":504,\"level\":2},{\"ability\":5069,\"time\":553,\"level\":3},{\"ability\":5071,\"time\":609,\"level\":4},{\"ability\":5069,\"time\":633,\"level\":5},{\"ability\":5073,\"time\":739,\"level\":6},{\"ability\":5069,\"time\":860,\"level\":7},{\"ability\":5071,\"time\":973,\"level\":8},{\"ability\":5071,\"time\":1100,\"level\":9},{\"ability\":5071,\"time\":1258,\"level\":10},{\"ability\":5073,\"time\":1344,\"level\":11},{\"ability\":5072,\"time\":1570,\"level\":12},{\"ability\":5072,\"time\":1681,\"level\":13},{\"ability\":5072,\"time\":1754,\"level\":14},{\"ability\":5073,\"time\":1857,\"level\":15},{\"ability\":5002,\"time\":1868,\"level\":16},{\"ability\":5002,\"time\":1961,\"level\":17},{\"ability\":5002,\"time\":2207,\"level\":18},{\"ability\":5002,\"time\":2366,\"level\":19},{\"ability\":5002,\"time\":2379,\"level\":20},{\"ability\":5002,\"time\":2515,\"level\":21},{\"ability\":5002,\"time\":2699,\"level\":22},{\"ability\":5002,\"time\":2828,\"level\":23},{\"ability\":5002,\"time\":3060,\"level\":24}]},{\"account_id\":93115498,\"player_slot\":129,\"hero_id\":1,\"item_0\":147,\"item_1\":145,\"item_2\":63,\"item_3\":143,\"item_4\":139,\"item_5\":71,\"kills\":20,\"deaths\":4,\"assists\":8,\"leaver_status\":0,\"gold\":6252,\"last_hits\":343,\"denies\":35,\"gold_per_min\":691,\"xp_per_min\":712,\"gold_spent\":22134,\"hero_damage\":25343,\"tower_damage\":5981,\"hero_healing\":0,\"level\":24,\"ability_upgrades\":[{\"ability\":5004,\"time\":377,\"level\":1},{\"ability\":5003,\"time\":526,\"level\":2},{\"ability\":5004,\"time\":591,\"level\":3},{\"ability\":5005,\"time\":617,\"level\":4},{\"ability\":5004,\"time\":683,\"level\":5},{\"ability\":5006,\"time\":778,\"level\":6},{\"ability\":5004,\"time\":936,\"level\":7},{\"ability\":5003,\"time\":1036,\"level\":8},{\"ability\":5003,\"time\":1176,\"level\":9},{\"ability\":5003,\"time\":1363,\"level\":10},{\"ability\":5006,\"time\":1414,\"level\":11},{\"ability\":5005,\"time\":1545,\"level\":12},{\"ability\":5005,\"time\":1632,\"level\":13},{\"ability\":5005,\"time\":1677,\"level\":14},{\"ability\":5002,\"time\":1828,\"level\":15},{\"ability\":5006,\"time\":1893,\"level\":16},{\"ability\":5002,\"time\":2003,\"level\":17},{\"ability\":5002,\"time\":2136,\"level\":18},{\"ability\":5002,\"time\":2345,\"level\":19},{\"ability\":5002,\"time\":2398,\"level\":20},{\"ability\":5002,\"time\":2633,\"level\":21},{\"ability\":5002,\"time\":2757,\"level\":22},{\"ability\":5002,\"time\":2839,\"level\":23},{\"ability\":5002,\"time\":3092,\"level\":24}]},{\"account_id\":5789937,\"player_slot\":130,\"hero_id\":16,\"item_0\":1,\"item_1\":190,\"item_2\":180,\"item_3\":108,\"item_4\":36,\"item_5\":46,\"kills\":4,\"deaths\":6,\"assists\":26,\"leaver_status\":0,\"gold\":2744,\"last_hits\":109,\"denies\":2,\"gold_per_min\":359,\"xp_per_min\":536,\"gold_spent\":13304,\"hero_damage\":15762,\"tower_damage\":673,\"hero_healing\":0,\"level\":21,\"ability_upgrades\":[{\"ability\":5102,\"time\":447,\"level\":1},{\"ability\":5103,\"time\":651,\"level\":2},{\"ability\":5102,\"time\":692,\"level\":3},{\"ability\":5103,\"time\":937,\"level\":4},{\"ability\":5102,\"time\":1101,\"level\":5},{\"ability\":5105,\"time\":1263,\"level\":6},{\"ability\":5102,\"time\":1488,\"level\":7},{\"ability\":5104,\"time\":1602,\"level\":8},{\"ability\":5103,\"time\":1740,\"level\":9},{\"ability\":5105,\"time\":1845,\"level\":10},{\"ability\":5104,\"time\":1849,\"level\":11},{\"ability\":5103,\"time\":2002,\"level\":12},{\"ability\":5104,\"time\":2132,\"level\":13},{\"ability\":5104,\"time\":2194,\"level\":14},{\"ability\":5002,\"time\":2338,\"level\":15},{\"ability\":5105,\"time\":2344,\"level\":16},{\"ability\":5002,\"time\":2461,\"level\":17},{\"ability\":5002,\"time\":2516,\"level\":18},{\"ability\":5002,\"time\":2806,\"level\":19},{\"ability\":5002,\"time\":2903,\"level\":20},{\"ability\":5002,\"time\":3071,\"level\":21}]},{\"account_id\":4294967295,\"player_slot\":131,\"hero_id\":40,\"item_0\":79,\"item_1\":108,\"item_2\":180,\"item_3\":34,\"item_4\":46,\"item_5\":16,\"kills\":4,\"deaths\":8,\"assists\":32,\"leaver_status\":0,\"gold\":2584,\"last_hits\":54,\"denies\":6,\"gold_per_min\":308,\"xp_per_min\":433,\"gold_spent\":11744,\"hero_damage\":14768,\"tower_damage\":1614,\"hero_healing\":3227,\"level\":19,\"ability_upgrades\":[{\"ability\":5178,\"time\":398,\"level\":1},{\"ability\":5179,\"time\":761,\"level\":2},{\"ability\":5179,\"time\":893,\"level\":3},{\"ability\":5180,\"time\":1012,\"level\":4},{\"ability\":5180,\"time\":1230,\"level\":5},{\"ability\":5181,\"time\":1248,\"level\":6},{\"ability\":5180,\"time\":1364,\"level\":7},{\"ability\":5180,\"time\":1387,\"level\":8},{\"ability\":5178,\"time\":1434,\"level\":9},{\"ability\":5178,\"time\":1524,\"level\":10},{\"ability\":5181,\"time\":1624,\"level\":11},{\"ability\":5178,\"time\":2010,\"level\":12},{\"ability\":5002,\"time\":2102,\"level\":13},{\"ability\":5002,\"time\":2201,\"level\":14},{\"ability\":5179,\"time\":2500,\"level\":15},{\"ability\":5002,\"time\":2632,\"level\":16},{\"ability\":5181,\"time\":2805,\"level\":17},{\"ability\":5179,\"time\":2929,\"level\":18},{\"ability\":5002,\"time\":3078,\"level\":19}]},{\"account_id\":88491477,\"player_slot\":132,\"hero_id\":100,\"item_0\":50,\"item_1\":185,\"item_2\":46,\"item_3\":168,\"item_4\":0,\"item_5\":0,\"kills\":8,\"deaths\":9,\"assists\":12,\"leaver_status\":0,\"gold\":1720,\"last_hits\":45,\"denies\":0,\"gold_per_min\":283,\"xp_per_min\":412,\"gold_spent\":9461,\"hero_damage\":14000,\"tower_damage\":98,\"hero_healing\":0,\"level\":18,\"ability_upgrades\":[{\"ability\":5565,\"time\":565,\"level\":1},{\"ability\":5566,\"time\":581,\"level\":2},{\"ability\":5565,\"time\":610,\"level\":3},{\"ability\":5566,\"time\":684,\"level\":4},{\"ability\":5565,\"time\":784,\"level\":5},{\"ability\":5568,\"time\":928,\"level\":6},{\"ability\":5565,\"time\":972,\"level\":7},{\"ability\":5566,\"time\":1031,\"level\":8},{\"ability\":5566,\"time\":1128,\"level\":9},{\"ability\":5568,\"time\":1391,\"level\":10},{\"ability\":5567,\"time\":1392,\"level\":11},{\"ability\":5567,\"time\":1628,\"level\":12},{\"ability\":5567,\"time\":2056,\"level\":13},{\"ability\":5567,\"time\":2205,\"level\":14},{\"ability\":5002,\"time\":2251,\"level\":15},{\"ability\":5568,\"time\":2343,\"level\":16},{\"ability\":5002,\"time\":2629,\"level\":17},{\"ability\":5002,\"time\":2834,\"level\":18}]}],\"radiant_win\":false,\"duration\":2670,\"start_time\":1381894089,\"match_id\":346700273,\"match_seq_num\":315943455,\"tower_status_radiant\":384,\"tower_status_dire\":1798,\"barracks_status_radiant\":48,\"barracks_status_dire\":59,\"cluster\":123,\"first_blood_time\":170,\"lobby_type\":0,\"human_players\":10,\"leagueid\":0,\"positive_votes\":0,\"negative_votes\":0,\"game_mode\":16,\"picks_bans\":[{\"is_pick\":false,\"hero_id\":71,\"team\":1,\"order\":0},{\"is_pick\":false,\"hero_id\":15,\"team\":0,\"order\":1},{\"is_pick\":false,\"hero_id\":75,\"team\":1,\"order\":2},{\"is_pick\":false,\"hero_id\":54,\"team\":0,\"order\":3},{\"is_pick\":true,\"hero_id\":13,\"team\":1,\"order\":4},{\"is_pick\":true,\"hero_id\":86,\"team\":0,\"order\":5},{\"is_pick\":true,\"hero_id\":5,\"team\":0,\"order\":6},{\"is_pick\":true,\"hero_id\":16,\"team\":1,\"order\":7},{\"is_pick\":true,\"hero_id\":40,\"team\":1,\"order\":8},{\"is_pick\":true,\"hero_id\":19,\"team\":0,\"order\":9},{\"is_pick\":true,\"hero_id\":3,\"team\":0,\"order\":10},{\"is_pick\":true,\"hero_id\":1,\"team\":1,\"order\":11},{\"is_pick\":true,\"hero_id\":100,\"team\":1,\"order\":12},{\"is_pick\":true,\"hero_id\":82,\"team\":0,\"order\":13}]}}"
  }

  let( :recent_match_details_parsed ) {
    {"result"=>{"players"=>[{"account_id"=>33977142, "player_slot"=>0, "hero_id"=>86, "item_0"=>100, "item_1"=>37, "item_2"=>50, "item_3"=>1, "item_4"=>41, "item_5"=>0, "kills"=>5, "deaths"=>8, "assists"=>8, "leaver_status"=>0, "gold"=>853, "last_hits"=>78, "denies"=>4, "gold_per_min"=>283, "xp_per_min"=>299, "gold_spent"=>10937, "hero_damage"=>10004, "tower_damage"=>464, "hero_healing"=>0, "level"=>15, "ability_upgrades"=>[{"ability"=>5448, "time"=>371, "level"=>1}, {"ability"=>5450, "time"=>534, "level"=>2}, {"ability"=>5450, "time"=>721, "level"=>3}, {"ability"=>5451, "time"=>840, "level"=>4}, {"ability"=>5450, "time"=>904, "level"=>5}, {"ability"=>5452, "time"=>1160, "level"=>6}, {"ability"=>5450, "time"=>1197, "level"=>7}, {"ability"=>5451, "time"=>1251, "level"=>8}, {"ability"=>5451, "time"=>1417, "level"=>9}, {"ability"=>5452, "time"=>1749, "level"=>10}, {"ability"=>5451, "time"=>1749, "level"=>11}, {"ability"=>5448, "time"=>2092, "level"=>12}, {"ability"=>5448, "time"=>2276, "level"=>13}, {"ability"=>5448, "time"=>2551, "level"=>14}, {"ability"=>5002, "time"=>2947, "level"=>15}]}, {"account_id"=>34575066, "player_slot"=>1, "hero_id"=>19, "item_0"=>1, "item_1"=>147, "item_2"=>41, "item_3"=>63, "item_4"=>108, "item_5"=>0, "kills"=>9, "deaths"=>9, "assists"=>13, "leaver_status"=>0, "gold"=>385, "last_hits"=>190, "denies"=>13, "gold_per_min"=>400, "xp_per_min"=>428, "gold_spent"=>15134, "hero_damage"=>20473, "tower_damage"=>1684, "hero_healing"=>0, "level"=>19, "ability_upgrades"=>[{"ability"=>5106, "time"=>387, "level"=>1}, {"ability"=>5107, "time"=>543, "level"=>2}, {"ability"=>5106, "time"=>543, "level"=>3}, {"ability"=>5107, "time"=>603, "level"=>4}, {"ability"=>5106, "time"=>691, "level"=>5}, {"ability"=>5109, "time"=>742, "level"=>6}, {"ability"=>5107, "time"=>802, "level"=>7}, {"ability"=>5107, "time"=>835, "level"=>8}, {"ability"=>5106, "time"=>1040, "level"=>9}, {"ability"=>5108, "time"=>1182, "level"=>10}, {"ability"=>5109, "time"=>1206, "level"=>11}, {"ability"=>5108, "time"=>1450, "level"=>12}, {"ability"=>5108, "time"=>1551, "level"=>13}, {"ability"=>5108, "time"=>1750, "level"=>14}, {"ability"=>5002, "time"=>2060, "level"=>15}, {"ability"=>5109, "time"=>2440, "level"=>16}, {"ability"=>5002, "time"=>2558, "level"=>17}, {"ability"=>5002, "time"=>2798, "level"=>18}, {"ability"=>5002, "time"=>3028, "level"=>19}]}, {"account_id"=>4294967295, "player_slot"=>2, "hero_id"=>82, "item_0"=>63, "item_1"=>53, "item_2"=>108, "item_3"=>81, "item_4"=>1, "item_5"=>61, "kills"=>6, "deaths"=>12, "assists"=>8, "leaver_status"=>0, "gold"=>744, "last_hits"=>260, "denies"=>10, "gold_per_min"=>460, "xp_per_min"=>730, "gold_spent"=>15270, "hero_damage"=>12810, "tower_damage"=>2113, "hero_healing"=>105, "level"=>25, "ability_upgrades"=>[{"ability"=>5430, "time"=>505, "level"=>1}, {"ability"=>5431, "time"=>512, "level"=>2}, {"ability"=>5431, "time"=>560, "level"=>3}, {"ability"=>5432, "time"=>649, "level"=>4}, {"ability"=>5431, "time"=>734, "level"=>5}, {"ability"=>5433, "time"=>855, "level"=>6}, {"ability"=>5431, "time"=>907, "level"=>7}, {"ability"=>5430, "time"=>965, "level"=>8}, {"ability"=>5430, "time"=>1055, "level"=>9}, {"ability"=>5430, "time"=>1132, "level"=>10}, {"ability"=>5433, "time"=>1181, "level"=>11}, {"ability"=>5432, "time"=>1358, "level"=>12}, {"ability"=>5432, "time"=>1478, "level"=>13}, {"ability"=>5432, "time"=>1567, "level"=>14}, {"ability"=>5002, "time"=>1628, "level"=>15}, {"ability"=>5433, "time"=>1780, "level"=>16}, {"ability"=>5002, "time"=>1857, "level"=>17}, {"ability"=>5002, "time"=>2027, "level"=>18}, {"ability"=>5002, "time"=>2220, "level"=>19}, {"ability"=>5002, "time"=>2357, "level"=>20}, {"ability"=>5002, "time"=>2467, "level"=>21}, {"ability"=>5002, "time"=>2551, "level"=>22}, {"ability"=>5002, "time"=>2551, "level"=>23}, {"ability"=>5002, "time"=>2593, "level"=>24}, {"ability"=>5002, "time"=>2788, "level"=>25}]}, {"account_id"=>7384958, "player_slot"=>3, "hero_id"=>5, "item_0"=>79, "item_1"=>180, "item_2"=>36, "item_3"=>46, "item_4"=>23, "item_5"=>27, "kills"=>5, "deaths"=>9, "assists"=>10, "leaver_status"=>0, "gold"=>38, "last_hits"=>36, "denies"=>3, "gold_per_min"=>209, "xp_per_min"=>244, "gold_spent"=>8786, "hero_damage"=>7682, "tower_damage"=>193, "hero_healing"=>423, "level"=>14, "ability_upgrades"=>[{"ability"=>5127, "time"=>467, "level"=>1}, {"ability"=>5126, "time"=>793, "level"=>2}, {"ability"=>5126, "time"=>882, "level"=>3}, {"ability"=>5128, "time"=>981, "level"=>4}, {"ability"=>5126, "time"=>1105, "level"=>5}, {"ability"=>5127, "time"=>1259, "level"=>6}, {"ability"=>5126, "time"=>1323, "level"=>7}, {"ability"=>5127, "time"=>1460, "level"=>8}, {"ability"=>5128, "time"=>1558, "level"=>9}, {"ability"=>5128, "time"=>1585, "level"=>10}, {"ability"=>5128, "time"=>1753, "level"=>11}, {"ability"=>5129, "time"=>2411, "level"=>12}, {"ability"=>5129, "time"=>2496, "level"=>13}, {"ability"=>5127, "time"=>3067, "level"=>14}]}, {"account_id"=>52816, "player_slot"=>4, "hero_id"=>3, "item_0"=>90, "item_1"=>180, "item_2"=>42, "item_3"=>36, "item_4"=>46, "item_5"=>21, "kills"=>8, "deaths"=>9, "assists"=>7, "leaver_status"=>0, "gold"=>949, "last_hits"=>34, "denies"=>16, "gold_per_min"=>237, "xp_per_min"=>334, "gold_spent"=>9130, "hero_damage"=>7016, "tower_damage"=>423, "hero_healing"=>0, "level"=>16, "ability_upgrades"=>[{"ability"=>5011, "time"=>491, "level"=>1}, {"ability"=>5014, "time"=>631, "level"=>2}, {"ability"=>5011, "time"=>784, "level"=>3}, {"ability"=>5012, "time"=>976, "level"=>4}, {"ability"=>5011, "time"=>1101, "level"=>5}, {"ability"=>5013, "time"=>1181, "level"=>6}, {"ability"=>5011, "time"=>1319, "level"=>7}, {"ability"=>5012, "time"=>1435, "level"=>8}, {"ability"=>5012, "time"=>1581, "level"=>9}, {"ability"=>5012, "time"=>1668, "level"=>10}, {"ability"=>5013, "time"=>1709, "level"=>11}, {"ability"=>5014, "time"=>1747, "level"=>12}, {"ability"=>5014, "time"=>1909, "level"=>13}, {"ability"=>5014, "time"=>2128, "level"=>14}, {"ability"=>5002, "time"=>2499, "level"=>15}, {"ability"=>5013, "time"=>2885, "level"=>16}]}, {"account_id"=>4294967295, "player_slot"=>128, "hero_id"=>13, "item_0"=>1, "item_1"=>100, "item_2"=>96, "item_3"=>36, "item_4"=>63, "item_5"=>46, "kills"=>9, "deaths"=>7, "assists"=>29, "leaver_status"=>0, "gold"=>3379, "last_hits"=>155, "denies"=>7, "gold_per_min"=>452, "xp_per_min"=>706, "gold_spent"=>15259, "hero_damage"=>24236, "tower_damage"=>2159, "hero_healing"=>0, "level"=>24, "ability_upgrades"=>[{"ability"=>5069, "time"=>410, "level"=>1}, {"ability"=>5072, "time"=>504, "level"=>2}, {"ability"=>5069, "time"=>553, "level"=>3}, {"ability"=>5071, "time"=>609, "level"=>4}, {"ability"=>5069, "time"=>633, "level"=>5}, {"ability"=>5073, "time"=>739, "level"=>6}, {"ability"=>5069, "time"=>860, "level"=>7}, {"ability"=>5071, "time"=>973, "level"=>8}, {"ability"=>5071, "time"=>1100, "level"=>9}, {"ability"=>5071, "time"=>1258, "level"=>10}, {"ability"=>5073, "time"=>1344, "level"=>11}, {"ability"=>5072, "time"=>1570, "level"=>12}, {"ability"=>5072, "time"=>1681, "level"=>13}, {"ability"=>5072, "time"=>1754, "level"=>14}, {"ability"=>5073, "time"=>1857, "level"=>15}, {"ability"=>5002, "time"=>1868, "level"=>16}, {"ability"=>5002, "time"=>1961, "level"=>17}, {"ability"=>5002, "time"=>2207, "level"=>18}, {"ability"=>5002, "time"=>2366, "level"=>19}, {"ability"=>5002, "time"=>2379, "level"=>20}, {"ability"=>5002, "time"=>2515, "level"=>21}, {"ability"=>5002, "time"=>2699, "level"=>22}, {"ability"=>5002, "time"=>2828, "level"=>23}, {"ability"=>5002, "time"=>3060, "level"=>24}]}, {"account_id"=>93115498, "player_slot"=>129, "hero_id"=>1, "item_0"=>147, "item_1"=>145, "item_2"=>63, "item_3"=>143, "item_4"=>139, "item_5"=>71, "kills"=>20, "deaths"=>4, "assists"=>8, "leaver_status"=>0, "gold"=>6252, "last_hits"=>343, "denies"=>35, "gold_per_min"=>691, "xp_per_min"=>712, "gold_spent"=>22134, "hero_damage"=>25343, "tower_damage"=>5981, "hero_healing"=>0, "level"=>24, "ability_upgrades"=>[{"ability"=>5004, "time"=>377, "level"=>1}, {"ability"=>5003, "time"=>526, "level"=>2}, {"ability"=>5004, "time"=>591, "level"=>3}, {"ability"=>5005, "time"=>617, "level"=>4}, {"ability"=>5004, "time"=>683, "level"=>5}, {"ability"=>5006, "time"=>778, "level"=>6}, {"ability"=>5004, "time"=>936, "level"=>7}, {"ability"=>5003, "time"=>1036, "level"=>8}, {"ability"=>5003, "time"=>1176, "level"=>9}, {"ability"=>5003, "time"=>1363, "level"=>10}, {"ability"=>5006, "time"=>1414, "level"=>11}, {"ability"=>5005, "time"=>1545, "level"=>12}, {"ability"=>5005, "time"=>1632, "level"=>13}, {"ability"=>5005, "time"=>1677, "level"=>14}, {"ability"=>5002, "time"=>1828, "level"=>15}, {"ability"=>5006, "time"=>1893, "level"=>16}, {"ability"=>5002, "time"=>2003, "level"=>17}, {"ability"=>5002, "time"=>2136, "level"=>18}, {"ability"=>5002, "time"=>2345, "level"=>19}, {"ability"=>5002, "time"=>2398, "level"=>20}, {"ability"=>5002, "time"=>2633, "level"=>21}, {"ability"=>5002, "time"=>2757, "level"=>22}, {"ability"=>5002, "time"=>2839, "level"=>23}, {"ability"=>5002, "time"=>3092, "level"=>24}]}, {"account_id"=>5789937, "player_slot"=>130, "hero_id"=>16, "item_0"=>1, "item_1"=>190, "item_2"=>180, "item_3"=>108, "item_4"=>36, "item_5"=>46, "kills"=>4, "deaths"=>6, "assists"=>26, "leaver_status"=>0, "gold"=>2744, "last_hits"=>109, "denies"=>2, "gold_per_min"=>359, "xp_per_min"=>536, "gold_spent"=>13304, "hero_damage"=>15762, "tower_damage"=>673, "hero_healing"=>0, "level"=>21, "ability_upgrades"=>[{"ability"=>5102, "time"=>447, "level"=>1}, {"ability"=>5103, "time"=>651, "level"=>2}, {"ability"=>5102, "time"=>692, "level"=>3}, {"ability"=>5103, "time"=>937, "level"=>4}, {"ability"=>5102, "time"=>1101, "level"=>5}, {"ability"=>5105, "time"=>1263, "level"=>6}, {"ability"=>5102, "time"=>1488, "level"=>7}, {"ability"=>5104, "time"=>1602, "level"=>8}, {"ability"=>5103, "time"=>1740, "level"=>9}, {"ability"=>5105, "time"=>1845, "level"=>10}, {"ability"=>5104, "time"=>1849, "level"=>11}, {"ability"=>5103, "time"=>2002, "level"=>12}, {"ability"=>5104, "time"=>2132, "level"=>13}, {"ability"=>5104, "time"=>2194, "level"=>14}, {"ability"=>5002, "time"=>2338, "level"=>15}, {"ability"=>5105, "time"=>2344, "level"=>16}, {"ability"=>5002, "time"=>2461, "level"=>17}, {"ability"=>5002, "time"=>2516, "level"=>18}, {"ability"=>5002, "time"=>2806, "level"=>19}, {"ability"=>5002, "time"=>2903, "level"=>20}, {"ability"=>5002, "time"=>3071, "level"=>21}]}, {"account_id"=>4294967295, "player_slot"=>131, "hero_id"=>40, "item_0"=>79, "item_1"=>108, "item_2"=>180, "item_3"=>34, "item_4"=>46, "item_5"=>16, "kills"=>4, "deaths"=>8, "assists"=>32, "leaver_status"=>0, "gold"=>2584, "last_hits"=>54, "denies"=>6, "gold_per_min"=>308, "xp_per_min"=>433, "gold_spent"=>11744, "hero_damage"=>14768, "tower_damage"=>1614, "hero_healing"=>3227, "level"=>19, "ability_upgrades"=>[{"ability"=>5178, "time"=>398, "level"=>1}, {"ability"=>5179, "time"=>761, "level"=>2}, {"ability"=>5179, "time"=>893, "level"=>3}, {"ability"=>5180, "time"=>1012, "level"=>4}, {"ability"=>5180, "time"=>1230, "level"=>5}, {"ability"=>5181, "time"=>1248, "level"=>6}, {"ability"=>5180, "time"=>1364, "level"=>7}, {"ability"=>5180, "time"=>1387, "level"=>8}, {"ability"=>5178, "time"=>1434, "level"=>9}, {"ability"=>5178, "time"=>1524, "level"=>10}, {"ability"=>5181, "time"=>1624, "level"=>11}, {"ability"=>5178, "time"=>2010, "level"=>12}, {"ability"=>5002, "time"=>2102, "level"=>13}, {"ability"=>5002, "time"=>2201, "level"=>14}, {"ability"=>5179, "time"=>2500, "level"=>15}, {"ability"=>5002, "time"=>2632, "level"=>16}, {"ability"=>5181, "time"=>2805, "level"=>17}, {"ability"=>5179, "time"=>2929, "level"=>18}, {"ability"=>5002, "time"=>3078, "level"=>19}]}, {"account_id"=>88491477, "player_slot"=>132, "hero_id"=>100, "item_0"=>50, "item_1"=>185, "item_2"=>46, "item_3"=>168, "item_4"=>0, "item_5"=>0, "kills"=>8, "deaths"=>9, "assists"=>12, "leaver_status"=>0, "gold"=>1720, "last_hits"=>45, "denies"=>0, "gold_per_min"=>283, "xp_per_min"=>412, "gold_spent"=>9461, "hero_damage"=>14000, "tower_damage"=>98, "hero_healing"=>0, "level"=>18, "ability_upgrades"=>[{"ability"=>5565, "time"=>565, "level"=>1}, {"ability"=>5566, "time"=>581, "level"=>2}, {"ability"=>5565, "time"=>610, "level"=>3}, {"ability"=>5566, "time"=>684, "level"=>4}, {"ability"=>5565, "time"=>784, "level"=>5}, {"ability"=>5568, "time"=>928, "level"=>6}, {"ability"=>5565, "time"=>972, "level"=>7}, {"ability"=>5566, "time"=>1031, "level"=>8}, {"ability"=>5566, "time"=>1128, "level"=>9}, {"ability"=>5568, "time"=>1391, "level"=>10}, {"ability"=>5567, "time"=>1392, "level"=>11}, {"ability"=>5567, "time"=>1628, "level"=>12}, {"ability"=>5567, "time"=>2056, "level"=>13}, {"ability"=>5567, "time"=>2205, "level"=>14}, {"ability"=>5002, "time"=>2251, "level"=>15}, {"ability"=>5568, "time"=>2343, "level"=>16}, {"ability"=>5002, "time"=>2629, "level"=>17}, {"ability"=>5002, "time"=>2834, "level"=>18}]}], "radiant_win"=>false, "duration"=>2670, "start_time"=>1381894089, "match_id"=>346700273, "match_seq_num"=>315943455, "tower_status_radiant"=>384, "tower_status_dire"=>1798, "barracks_status_radiant"=>48, "barracks_status_dire"=>59, "cluster"=>123, "first_blood_time"=>170, "lobby_type"=>0, "human_players"=>10, "leagueid"=>0, "positive_votes"=>0, "negative_votes"=>0, "game_mode"=>16, "picks_bans"=>[{"is_pick"=>false, "hero_id"=>71, "team"=>1, "order"=>0}, {"is_pick"=>false, "hero_id"=>15, "team"=>0, "order"=>1}, {"is_pick"=>false, "hero_id"=>75, "team"=>1, "order"=>2}, {"is_pick"=>false, "hero_id"=>54, "team"=>0, "order"=>3}, {"is_pick"=>true, "hero_id"=>13, "team"=>1, "order"=>4}, {"is_pick"=>true, "hero_id"=>86, "team"=>0, "order"=>5}, {"is_pick"=>true, "hero_id"=>5, "team"=>0, "order"=>6}, {"is_pick"=>true, "hero_id"=>16, "team"=>1, "order"=>7}, {"is_pick"=>true, "hero_id"=>40, "team"=>1, "order"=>8}, {"is_pick"=>true, "hero_id"=>19, "team"=>0, "order"=>9}, {"is_pick"=>true, "hero_id"=>3, "team"=>0, "order"=>10}, {"is_pick"=>true, "hero_id"=>1, "team"=>1, "order"=>11}, {"is_pick"=>true, "hero_id"=>100, "team"=>1, "order"=>12}, {"is_pick"=>true, "hero_id"=>82, "team"=>0, "order"=>13}]}}
  }

  subject { described_class.new api_key, account_id }

  let( :steam_helper_double ) { double( 'steam_helper' ) }

  before :each do
    WebApi.stub( :api_key= )
    SteamHelper.stub( :new ).and_return steam_helper_double
    steam_helper_double.stub( :get_matches ).and_return recent_match
    steam_helper_double.stub( :get_match_details ).and_return recent_match_details
    steam_helper_double.stub( :get_heroes ).and_return heroes
  end

  describe "#get_most_recent_match" do
    it "gets the most recent match id" do
      JSON.should_receive( :parse ).with( recent_match ).and_call_original
      subject.get_most_recent_match.
        should == parsed_match
    end
  end

  describe "#get_most_recent_match_details" do
    it "gets the details for the most recently played match" do
      JSON.should_receive( :parse ).with( recent_match_details ).and_call_original 
      JSON.should_receive( :parse ).with( recent_match ).and_call_original
      subject.get_most_recent_match_details.
        should == recent_match_details_parsed
    end
  end

  describe "#get_some_interesting_information" do
    it "does" do
      subject.get_some_interesting_information.
        should == <<-DOC
    You played as crystal maiden! You had 36 last_hits!
    You had 3 denies!
    You were on the radiant team!
    You lost that match!
        DOC
    end
  end
end
